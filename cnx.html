<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 4-6 ‡∏Å.‡∏û. | Premium Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        :root {
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --bg-input: #f1f5f9;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --nav-bg: rgba(255, 255, 255, 0.8);
            --accent-color: #2563eb;
        }

        [data-theme='dark'] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --nav-bg: rgba(30, 41, 59, 0.8);
            --accent-color: #3b82f6;
        }

        [data-theme='muji'] {
            --bg-body: #f4f1ea;
            --bg-card: #faf9f6;
            --bg-input: #efede7;
            --text-main: #4a4238;
            --text-muted: #8c7e6d;
            --border-color: #e2ddd3;
            --nav-bg: rgba(244, 241, 234, 0.8);
            --accent-color: #8c7e6d;
        }

        body { 
            font-family: 'Kanit', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-main);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .day-card { display: none; }
        .day-card.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .nav-btn.active { background-color: var(--accent-color); color: white; }

        .bg-card { background-color: var(--bg-card); border: 1px solid var(--border-color); }
        .bg-input { background-color: var(--bg-input); border: 1px solid var(--border-color); color: var(--text-main); }
        .text-main { color: var(--text-main); }
        .text-muted { color: var(--text-muted); }
        .accent-bg { background-color: var(--accent-color); }

        /* Dropdown Animation */
        .detail-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; opacity: 0; }
        .detail-content.show { max-height: 1200px; opacity: 1; transition: max-height 0.5s ease-in, opacity 0.3s ease-in; }
        .rotate-icon { transition: transform 0.3s ease; }
        .rotate-icon.active { transform: rotate(180deg); }

        /* Modal Summary & Forms */
        .modal-view { display: none; position: fixed; inset: 0; background-color: rgba(15, 23, 42, 0.6); z-index: 60; backdrop-filter: blur(4px); flex-direction: column; justify-content: flex-end; }
        .modal-view.active { display: flex; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Floating Action Button */
        .fab { position: fixed; bottom: 100px; right: 24px; z-index: 45; }
    </style>
</head>
<body class="pb-24">
    <!-- Header -->
    <header id="app-header" class="accent-bg text-white p-6 rounded-b-3xl shadow-lg sticky top-0 z-50 transition-all duration-500">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div class="w-10"></div>
            <div class="text-center">
                <h1 class="text-xl font-bold">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 3 ‡∏ß‡∏±‡∏ô 2 ‡∏Ñ‡∏∑‡∏ô</h1>
                <p class="text-white/80 text-xs">4 - 6 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå | ‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏° - ‡∏ï‡∏±‡∏ß‡πÄ‡∏°‡∏∑‡∏≠‡∏á</p>
            </div>
            <button onclick="cycleTheme()" class="w-10 h-10 flex items-center justify-center bg-white/20 rounded-full text-white">
                <i id="theme-icon" class="fas fa-sun"></i>
            </button>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="flex justify-around p-4 sticky top-20 z-40 bg-transparent backdrop-blur-sm">
        <div class="bg-card rounded-full shadow-md p-1 flex w-full max-w-md mx-auto">
            <button onclick="showDay(1)" id="btn-1" class="nav-btn active flex-1 py-2 px-4 rounded-full text-sm font-medium transition-all duration-300">4 ‡∏Å.‡∏û.</button>
            <button onclick="showDay(2)" id="btn-2" class="nav-btn flex-1 py-2 px-4 rounded-full text-sm font-medium transition-all duration-300">5 ‡∏Å.‡∏û.</button>
            <button onclick="showDay(3)" id="btn-3" class="nav-btn flex-1 py-2 px-4 rounded-full text-sm font-medium transition-all duration-300">6 ‡∏Å.‡∏û.</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-md mx-auto px-4" id="main-content">
        <section id="day-1" class="day-card active space-y-4"></section>
        <section id="day-2" class="day-card space-y-4"></section>
        <section id="day-3" class="day-card space-y-4"></section>
    </main>

    <!-- Floating Action Button (FAB) -->
    <div class="fab">
        <button id="fab-btn" onclick="openAddPlanModal(currentDay)" class="w-14 h-14 accent-bg text-white rounded-full shadow-2xl flex items-center justify-center text-2xl active:scale-90 transition-transform">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Modal: Add Custom Plan -->
    <div id="add-plan-modal" class="modal-view">
        <div class="bg-card w-full max-w-md mx-auto rounded-t-[2.5rem] p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">‚ú® ‡πÅ‡∏ó‡∏£‡∏Å‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span id="target-day-display">1</span>)</h2>
                <button onclick="toggleModal('add-plan-modal', false)" class="w-10 h-10 flex items-center justify-center bg-input rounded-full"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-[10px] font-bold opacity-50 mb-1 uppercase tracking-widest">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏¢‡πà‡∏≠‡∏¢ 5 ‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                        <!-- step="300" allows 5 minute increments (5 * 60 seconds) -->
                        <input type="time" id="new-plan-time" step="300" class="w-full p-3 bg-input rounded-xl outline-none border-none">
                    </div>
                    <div class="flex-1">
                        <label class="block text-[10px] font-bold opacity-50 mb-1 uppercase tracking-widest">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="new-plan-icon" class="w-full p-3 bg-input rounded-xl outline-none border-none">
                            <option value="map-marker-alt">üìç ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="utensils">üç¥ ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="coffee">‚òï ‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</option>
                            <option value="bed">üõèÔ∏è ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</option>
                            <option value="gas-pump">‚õΩ ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</option>
                            <option value="camera">üì∑ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] font-bold opacity-50 mb-1 uppercase tracking-widest">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                    <input type="text" id="new-plan-title" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ß‡∏∞‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏Å‡∏£‡∏ñ" class="w-full p-3 bg-input rounded-xl outline-none border-none">
                </div>
                <div>
                    <label class="block text-[10px] font-bold opacity-50 mb-1 uppercase tracking-widest">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea id="new-plan-details" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥" class="w-full p-3 bg-input rounded-xl outline-none border-none h-24"></textarea>
                </div>
                <button onclick="saveCustomPlan()" class="w-full py-4 accent-bg text-white rounded-2xl font-bold shadow-lg active:scale-95 transition-transform">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmation Delete -->
    <div id="delete-confirm-modal" class="modal-view">
        <div class="bg-card w-full max-w-md mx-auto rounded-t-[2.5rem] p-8 shadow-2xl text-center">
            <div class="w-20 h-20 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
            <p class="text-muted mb-8 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?</p>
            <div class="flex gap-4">
                <button onclick="toggleModal('delete-confirm-modal', false)" class="flex-1 py-4 bg-input text-muted rounded-2xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-delete-btn" class="flex-1 py-4 bg-red-500 text-white rounded-2xl font-bold">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <!-- Modal: Expense Summary & Fuel Log -->
    <div id="summary-view" class="modal-view">
        <div class="bg-card w-full max-w-md mx-auto rounded-t-[2.5rem] p-6 h-[85vh] overflow-y-auto shadow-2xl border-none">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ & ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h2>
                <button onclick="toggleModal('summary-view', false)" class="w-10 h-10 flex items-center justify-center bg-input rounded-full"><i class="fas fa-times"></i></button>
            </div>

            <!-- Total Card -->
            <div id="total-card" class="accent-bg rounded-3xl p-6 text-white mb-6 shadow-lg">
                <p class="text-white/80 text-sm mb-1">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <h3 class="text-4xl font-bold" id="total-trip-amount">‡∏ø0.00</h3>
                <div class="mt-4 pt-4 border-t border-white/20 flex justify-between">
                    <div>
                        <p class="text-[10px] opacity-70 uppercase tracking-widest">‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏ß‡∏°</p>
                        <p class="font-bold" id="total-fuel-amount">‡∏ø0.00</p>
                    </div>
                </div>
            </div>

            <!-- Fuel Entry Section (Theme Fixed) -->
            <div class="bg-input rounded-2xl p-5 mb-6 border-none">
                <h4 class="text-xs font-bold uppercase tracking-widest mb-4 opacity-70"><i class="fas fa-gas-pump mr-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h4>
                <div class="flex gap-2 mb-3">
                    <input type="time" id="fuel-time" step="300" class="w-24 text-sm p-3 rounded-xl border-none bg-card outline-none">
                    <input type="number" id="fuel-price" placeholder="‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)" min="0" class="flex-1 text-sm p-3 rounded-xl border-none bg-card outline-none">
                    <button onclick="addFuelRecord()" id="fuel-save-btn" class="accent-bg text-white px-4 rounded-xl text-xs font-bold shadow-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
                <div id="fuel-list" class="space-y-2">
                    <!-- Fuel items injected here -->
                </div>
            </div>

            <div id="summary-details" class="space-y-6"></div>
            
            <button onclick="clearAllData()" class="w-full mt-8 py-4 text-red-500 text-sm font-medium border border-red-100 rounded-2xl hover:bg-red-50 transition-colors">
                <i class="fas fa-history mr-2"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏£‡∏¥‡∏õ
            </button>
        </div>
    </div>

    <!-- Version Info -->
    <footer class="mt-8 mb-4 text-center">
        <p class="text-slate-400 text-[10px]">Version v1.7.3 (5-min Step Time)</p>
    </footer>

    <!-- Bottom Menu -->
    <nav style="background-color: var(--nav-bg);" class="fixed bottom-0 left-0 right-0 backdrop-blur-md border-t border-slate-200 px-6 py-3 flex justify-between items-center z-50">
        <div onclick="toggleModal('summary-view', false)" class="flex flex-col items-center cursor-pointer" style="color: var(--accent-color);">
            <i class="fas fa-calendar-day text-lg"></i>
            <span class="text-[10px] mt-1 font-bold">‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</span>
        </div>
        <div onclick="toggleModal('summary-view', true)" class="flex flex-col items-center text-slate-400 cursor-pointer">
            <i class="fas fa-wallet text-lg"></i>
            <span class="text-[10px] mt-1 font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
        </div>
        <div class="flex flex-col items-center text-slate-400 opacity-50">
            <i class="fas fa-user text-lg"></i>
            <span class="text-[10px] mt-1 font-bold">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
        </div>
    </nav>

    <script>
        const defaultLocations = [
            { id: '1-1', day: 1, time: '08:15', title: '‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', travel: '', details: '‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ô‡∏±‡∏î‡∏û‡∏ö (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≠‡∏¢‡∏£‡∏≠‡∏ö‡∏Ñ‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏±‡∏ö)', tips: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÉ‡∏ö‡∏Ç‡∏±‡∏ö‡∏Ç‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°', type: 'plane' },
            { id: '1-2', day: 1, time: '09:30', title: '‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏Æ‡∏∑‡∏≠‡∏ô 60', travel: 'üöó 20-30 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤/‡∏Ñ‡∏ß‡∏ö‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á ‡∏ó‡πà‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏£‡∏ì‡πÑ‡∏°‡πâ‡∏´‡∏≤‡∏¢‡∏≤‡∏Å', menu: '‡πÅ‡∏Å‡∏á‡πÄ‡∏ú‡πá‡∏î‡πÄ‡∏õ‡πá‡∏î‡∏¢‡πà‡∏≤‡∏á, ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏°‡∏∑‡∏≠‡∏á, ‡∏Å‡∏≤‡πÅ‡∏ü‡∏™‡∏î‡πÑ‡∏°‡πâ‡πÄ‡∏Æ‡∏∑‡∏≠‡∏ô', photo: '‡πÇ‡∏ã‡∏ô‡∏™‡∏ß‡∏ô‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏´‡∏°‡∏≠‡∏Å', type: 'utensils' },
            { id: '1-3', day: 1, time: '11:30', title: '‡πÇ‡∏õ‡πà‡∏á‡πÅ‡∏¢‡∏á ‡∏à‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡πâ‡∏• ‡πÇ‡∏Ñ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå', travel: 'üöó 45-60 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ö Jungle Coaster (‡∏£‡∏ñ‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πâ) ‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏ï‡∏Å', tips: '‡∏à‡∏¥‡∏ö‡∏Å‡∏≤‡πÅ‡∏ü‡∏ó‡∏µ‡πà "Jungle De Cafe" ‡∏ä‡∏°‡∏ß‡∏¥‡∏ß‡∏ô‡πâ‡∏≥‡∏ï‡∏Å‡πÑ‡∏î‡πâ', type: 'mountain' },
            { id: '1-4', day: 1, time: '13:30', title: '‡πÑ‡∏≠‡∏ô‡∏≤‡∏£‡∏≤ ‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏∏‡πà‡∏á‡∏ô‡∏≤‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏° ‡∏°‡∏µ‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÑ‡∏°‡πâ‡πÑ‡∏ú‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≠‡∏î‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡πà‡∏á‡∏ô‡∏≤', photo: '‡∏°‡∏∏‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏¥‡∏°‡∏ó‡∏∏‡πà‡∏á‡∏ô‡∏≤', type: 'coffee' },
            { id: '1-5', day: 1, time: '15:00', title: '‡∏°‡πà‡∏≠‡∏ô‡∏•‡∏°‡∏´‡∏ô‡∏≤‡∏ß ‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå', travel: 'üöó 15 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏•‡∏°‡πÄ‡∏¢‡πá‡∏ô‡πÜ ‡∏ì ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï‡∏ö‡∏ô‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏°', highlight: '‡∏ô‡∏±‡πà‡∏á‡∏ä‡∏°‡∏™‡∏≤‡∏¢‡∏´‡∏°‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å', type: 'bed' },
            { id: '1-6', day: 1, time: '16:30', title: '‡∏¢‡∏≠‡∏î‡∏î‡∏≠‡∏¢‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏°', travel: 'üöó 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡∏°‡∏ó‡∏∏‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏ô‡∏≤‡∏ß (‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏≠‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏µ‡∏ô‡πà‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏™‡∏°‡∏≠‡∏™)', tips: '‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡∏ä‡∏ô‡πÄ‡∏ú‡πà‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ ‡∏£‡∏≤‡∏Ñ‡∏≤ 50-100 ‡∏ö‡∏≤‡∏ó', type: 'camera' },
            { id: '1-7', day: 1, time: '18:30', title: '‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (‡∏°‡πà‡∏≠‡∏ô‡∏•‡∏°‡∏´‡∏ô‡∏≤‡∏ß)', travel: '', details: '‡∏ó‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏£‡∏±‡∏ö‡∏•‡∏°‡∏´‡∏ô‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å', type: 'fire' },
            { id: '2-1', day: 2, time: '10:30', title: '‡∏ß‡∏±‡∏î‡∏õ‡πà‡∏≤‡∏î‡∏≤‡∏£‡∏≤‡∏†‡∏¥‡∏£‡∏°‡∏¢‡πå', travel: 'üöó 45-50 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏ä‡∏°‡∏û‡∏£‡∏∞‡∏≠‡∏∏‡πÇ‡∏ö‡∏™‡∏ñ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏´‡∏≤‡∏£‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤‡∏ä‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏á‡∏î‡∏á‡∏≤‡∏°', tips: '‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏á‡∏î‡∏Ç‡∏≤‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏Ç‡πà‡∏≤', type: 'vihara' },
            { id: '2-2', day: 2, time: '12:00', title: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á: ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢', travel: 'üöó 20-30 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢‡πÅ‡∏°‡πà‡∏™‡∏≤‡∏¢ (‡∏¢‡πà‡∏≤‡∏ô‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô', menu: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠/‡πÑ‡∏Å‡πà, ‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏µ‡πâ‡∏¢‡∏ß, ‡πÑ‡∏™‡πâ‡∏≠‡∏±‡πà‡∏ß', type: 'utensils' },
            { id: '2-3', day: 2, time: '14:00', title: 'One Nimman / ‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô‡∏Ø', travel: 'üöó 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏¥‡∏ê‡πÅ‡∏î‡∏á', type: 'store' },
            { id: '2-4', day: 2, time: '16:30', title: '‡∏ß‡∏±‡∏î‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå‡∏´‡∏•‡∏ß‡∏á', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏ä‡∏°‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏™‡∏°‡∏±‡∏¢‡πÇ‡∏ö‡∏£‡∏≤‡∏ì ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏Å‡∏£‡∏á‡∏Ç‡∏≤‡∏°', type: 'vihara' },
            { id: '2-5', day: 2, time: '19:30', title: '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏ô‡∏ó‡πå‡∏ö‡∏≤‡∏ã‡∏≤‡∏£‡πå', travel: 'üöó 10-15 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÇ‡∏ã‡∏ô "Ploen Ruedee" ‡∏ü‡∏±‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏™‡∏î', type: 'moon' },
            { id: '3-1', day: 3, time: '10:00', title: '‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡∏°‡∏≤‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ï', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏£‡πà‡∏°‡∏£‡∏∑‡πà‡∏ô‡πÉ‡∏ï‡πâ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏ç‡πà ‡∏ä‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ï‡πå ‡∏á‡∏≤‡∏ô‡∏ó‡∏≥‡∏°‡∏∑‡∏≠', type: 'leaf' },
            { id: '3-2', day: 3, time: '12:00', title: '‡∏ä‡∏°‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà (Chom Cafe)', travel: 'üöó 20-25 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏õ‡πà‡∏≤‡∏´‡∏¥‡∏°‡∏û‡∏≤‡∏ô‡∏ï‡πå ‡∏°‡∏µ‡∏°‡∏≠‡∏™‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏ô‡πâ‡∏≥', type: 'utensils' },
            { id: '3-3', day: 3, time: '14:00', title: '‡∏°‡∏µ‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ó‡∏â‡∏∞ (Magokoro)', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏î‡∏∑‡πà‡∏°‡∏î‡πà‡∏≥‡∏Å‡∏±‡∏ö‡∏ä‡∏≤‡∏°‡∏±‡∏ó‡∏â‡∏∞‡πÄ‡∏Å‡∏£‡∏î‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ ‡πÉ‡∏ô‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πâ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', type: 'mug-hot' },
            { id: '3-4', day: 3, time: '16:30', title: '‡∏¢‡πà‡∏≤‡∏ô‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô‡∏Ø (‡∏™‡πà‡∏á‡∏ó‡πâ‡∏≤‡∏¢)', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: '‡∏ô‡∏±‡πà‡∏á Rooftop ‡∏ä‡∏°‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û‡∏¢‡∏≤‡∏°‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ï‡∏Å', type: 'glass-cheers' },
            { id: '3-5', day: 3, time: '19:30', title: '‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', travel: 'üöó 15-20 ‡∏ô‡∏≤‡∏ó‡∏µ', details: 'Check-in ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö (21:50 ‡∏ô.)', type: 'plane-departure' }
        ];

        let userPlans = JSON.parse(localStorage.getItem('cm_custom_plans')) || [];
        let expenses = JSON.parse(localStorage.getItem('cm_trip_expenses')) || [];
        let fuelLogs = JSON.parse(localStorage.getItem('cm_fuel_logs')) || [];
        let currentDay = 1;
        let planToDelete = null;
        let currentTheme = localStorage.getItem('cm_theme') || 'light';

        document.documentElement.setAttribute('data-theme', currentTheme);

        function cycleTheme() {
            const themes = ['light', 'dark', 'muji'];
            let nextIndex = (themes.indexOf(currentTheme) + 1) % themes.length;
            currentTheme = themes[nextIndex];
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('cm_theme', currentTheme);
            updateThemeUI();
        }

        function updateThemeUI() {
            const icon = document.getElementById('theme-icon');
            const root = document.documentElement;
            
            if (currentTheme === 'dark') {
                icon.className = 'fas fa-moon';
            } else if (currentTheme === 'muji') {
                icon.className = 'fas fa-leaf';
            } else {
                icon.className = 'fas fa-sun';
            }
            
            showDay(currentDay);
            updateUI();
        }

        function addFuelRecord() {
            const time = document.getElementById('fuel-time').value;
            const price = document.getElementById('fuel-price').value;
            if (!time || !price || parseFloat(price) < 0) return;

            fuelLogs.push({ id: Date.now(), day: currentDay, time, price: parseFloat(price) });
            localStorage.setItem('cm_fuel_logs', JSON.stringify(fuelLogs));
            document.getElementById('fuel-price').value = '';
            updateUI();
        }

        function deleteFuel(id) {
            fuelLogs = fuelLogs.filter(f => f.id !== id);
            localStorage.setItem('cm_fuel_logs', JSON.stringify(fuelLogs));
            updateUI();
        }

        function renderAll() {
            [1, 2, 3].forEach(day => {
                const container = document.getElementById('day-' + day);
                const dayLocs = [...defaultLocations, ...userPlans]
                    .filter(l => l.day === day)
                    .sort((a, b) => a.time.localeCompare(b.time));

                let html = `<div class="space-y-6 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-slate-300 before:to-transparent pt-4">`;

                dayLocs.forEach(loc => {
                    const isCustom = userPlans.some(up => up.id === loc.id);
                    html += `
                        <div class="relative flex items-start group">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full border-4 border-[var(--bg-body)] accent-bg text-white shadow-sm shrink-0 z-10">
                                <i class="fas fa-${loc.type} text-[10px]"></i>
                            </div>
                            <div class="w-[calc(100%-3rem)] bg-card p-4 rounded-2xl shadow-sm ml-4 cursor-pointer" onclick="toggleDetail('${loc.id}')">
                                <div class="flex justify-between items-start">
                                    <span class="text-[10px] font-bold tracking-wider opacity-60 uppercase">${loc.time}</span>
                                    <div class="flex gap-3 items-center">
                                        ${isCustom ? `<button onclick="event.stopPropagation(); requestDeletePlan('${loc.id}')" class="text-red-400 text-xs"><i class="fas fa-trash-alt"></i></button>` : ''}
                                        <i class="fas fa-chevron-down text-[10px] opacity-20 rotate-icon" id="icon-${loc.id}"></i>
                                    </div>
                                </div>
                                <h3 class="font-bold text-sm">${loc.title}</h3>
                                ${loc.travel ? `<p class="text-[10px] opacity-60 mt-1 italic">${loc.travel}</p>` : ''}
                                
                                <div id="detail-${loc.id}" class="detail-content mt-3 text-xs border-t border-[var(--border-color)] pt-3 space-y-3" onclick="event.stopPropagation()">
                                    <p class="text-muted"><strong>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong> ${loc.details}</p>
                                    ${loc.menu ? `<p class="text-muted"><strong>‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${loc.menu}</p>` : ''}
                                    ${loc.highlight ? `<p class="font-bold" style="color: var(--accent-color);"><strong>‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå:</strong> ${loc.highlight}</p>` : ''}
                                    
                                    <div class="mt-4 bg-[var(--bg-input)] p-3 rounded-xl">
                                        <p class="text-[9px] font-bold opacity-40 uppercase mb-2 tracking-widest">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>
                                        <div class="flex gap-2">
                                            <input type="text" id="exp-item-${loc.id}" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" class="flex-1 text-[11px] p-2 rounded-lg bg-card outline-none border-none">
                                            <input type="number" id="exp-price-${loc.id}" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="0" class="w-16 text-[11px] p-2 rounded-lg bg-card outline-none border-none">
                                            <button onclick="addExpense('${loc.id}', '${loc.title}', ${day})" class="accent-bg text-white w-8 h-8 rounded-lg flex items-center justify-center"><i class="fas fa-plus"></i></button>
                                        </div>
                                        <div id="exp-list-${loc.id}" class="mt-2 space-y-1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
                container.innerHTML = html;
            });
            updateUI();
            updateThemeUI();
        }

        function toggleDetail(id) {
            const content = document.getElementById('detail-' + id);
            const icon = document.getElementById('icon-' + id);
            if(content) content.classList.toggle('show');
            if(icon) icon.classList.toggle('active');
        }

        function showDay(day) {
            currentDay = day;
            document.querySelectorAll('.day-card').forEach(card => card.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const dayElem = document.getElementById('day-' + day);
            const btnElem = document.getElementById('btn-' + day);
            if(dayElem) dayElem.classList.add('active');
            if(btnElem) btnElem.classList.add('active');
            
            const root = document.documentElement;
            const header = document.getElementById('app-header');

            if (currentTheme === 'light') {
                let color = '#2563eb';
                if (day === 2) color = '#f97316';
                if (day === 3) color = '#0d9488';
                root.style.setProperty('--accent-color', color);
            } else if (currentTheme === 'muji') {
                root.style.setProperty('--accent-color', '#8c7e6d');
            } else {
                root.style.setProperty('--accent-color', '#3b82f6');
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function openAddPlanModal(day) {
            const display = document.getElementById('target-day-display');
            if(display) display.innerText = day;
            toggleModal('add-plan-modal', true);
        }

        function saveCustomPlan() {
            const time = document.getElementById('new-plan-time').value;
            const title = document.getElementById('new-plan-title').value;
            const details = document.getElementById('new-plan-details').value;
            const icon = document.getElementById('new-plan-icon').value;
            if (!time || !title) return;
            userPlans.push({ id: 'custom-' + Date.now(), day: currentDay, time, title, details: details || '-', type: icon });
            localStorage.setItem('cm_custom_plans', JSON.stringify(userPlans));
            toggleModal('add-plan-modal', false);
            renderAll();
        }

        function requestDeletePlan(id) {
            planToDelete = id;
            toggleModal('delete-confirm-modal', true);
        }

        function executeDeletePlan() {
            if (planToDelete) {
                userPlans = userPlans.filter(p => p.id !== planToDelete);
                expenses = expenses.filter(e => e.locId !== planToDelete);
                localStorage.setItem('cm_custom_plans', JSON.stringify(userPlans));
                localStorage.setItem('cm_trip_expenses', JSON.stringify(expenses));
                planToDelete = null;
                toggleModal('delete-confirm-modal', false);
                renderAll();
            }
        }

        function addExpense(locId, locTitle, day) {
            const item = document.getElementById(`exp-item-${locId}`);
            const price = document.getElementById(`exp-price-${locId}`);
            const priceVal = parseFloat(price.value);
            if (!item.value || isNaN(priceVal) || priceVal < 0) return;
            expenses.push({ id: Date.now(), locId, locTitle, day, item: item.value, price: priceVal });
            localStorage.setItem('cm_trip_expenses', JSON.stringify(expenses));
            item.value = ''; price.value = '';
            updateUI();
        }

        function deleteExp(id) {
            expenses = expenses.filter(e => e.id !== id);
            localStorage.setItem('cm_trip_expenses', JSON.stringify(expenses));
            updateUI();
        }

        function updateUI() {
            const allLocs = [...defaultLocations, ...userPlans];
            allLocs.forEach(loc => {
                const list = document.getElementById(`exp-list-${loc.id}`);
                if (list) {
                    list.innerHTML = expenses.filter(e => e.locId === loc.id).map(e => `
                        <div class="flex justify-between items-center text-[10px] bg-card p-2 rounded-lg shadow-sm">
                            <span class="opacity-70">${e.item}</span>
                            <div class="flex items-center gap-2">
                                <span class="font-bold">‡∏ø${e.price.toLocaleString()}</span>
                                <button onclick="deleteExp(${e.id})" class="opacity-20"><i class="fas fa-times-circle"></i></button>
                            </div>
                        </div>
                    `).join('');
                }
            });

            const fuelListElem = document.getElementById('fuel-list');
            if(fuelListElem) {
                fuelListElem.innerHTML = fuelLogs.map(f => `
                    <div class="flex justify-between items-center text-xs bg-card p-3 rounded-xl shadow-sm">
                        <span class="font-medium">${f.time} ‡∏ô.</span>
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-orange-500">‡∏ø${f.price.toLocaleString()}</span>
                            <button onclick="deleteFuel(${f.id})" class="opacity-30"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
            }

            const totalExp = expenses.reduce((s, e) => s + e.price, 0);
            const totalFuel = fuelLogs.reduce((s, f) => s + f.price, 0);
            const totalTripElem = document.getElementById('total-trip-amount');
            const totalFuelElem = document.getElementById('total-fuel-amount');
            if(totalTripElem) totalTripElem.innerText = '‡∏ø' + (totalExp + totalFuel).toLocaleString();
            if(totalFuelElem) totalFuelElem.innerText = '‡∏ø' + totalFuel.toLocaleString();
            
            let summaryHtml = '';
            [1, 2, 3].forEach(day => {
                const dayExps = expenses.filter(e => e.day === day);
                const dayTotal = dayExps.reduce((s, e) => s + e.price, 0);
                if (dayExps.length > 0) {
                    summaryHtml += `
                        <div class="border-b border-[var(--border-color)] pb-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-bold text-xs opacity-60">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${day} (${day + 3} ‡∏Å.‡∏û.)</h4>
                                <span class="font-bold text-sm">‡∏ø${dayTotal.toLocaleString()}</span>
                            </div>
                            <div class="space-y-1">
                                ${dayExps.map(e => `<div class="flex justify-between text-[11px] opacity-70"><span>${e.item} (${e.locTitle})</span><span>‡∏ø${e.price.toLocaleString()}</span></div>`).join('')}
                            </div>
                        </div>
                    `;
                }
            });
            const summaryDetailsElem = document.getElementById('summary-details');
            if(summaryDetailsElem) summaryDetailsElem.innerHTML = summaryHtml || '<p class="text-center text-slate-400 py-10 font-light text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>';
        }

        function toggleModal(id, show) {
            const modal = document.getElementById(id);
            if(modal) {
                if(show) modal.classList.add('active');
                else modal.classList.remove('active');
            }
        }

        function clearAllData() {
            if (confirm('‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£')) {
                localStorage.clear();
                window.location.reload();
            }
        }

        document.getElementById('confirm-delete-btn').onclick = executeDeletePlan;
        window.onload = renderAll;
    </script>
</body>
</html>
